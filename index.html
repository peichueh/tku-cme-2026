<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>2026 æ·¡æ±ŸåŒ–æç ”è¨æœƒè©•åˆ†ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-firestore-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
      .admin-tab.active {
        border-bottom: 3px solid #1e3a8a;
        color: #1e3a8a;
        font-weight: bold;
      }
      .dimension-card {
        border-left: 4px solid #3b82f6;
        padding: 1rem;
        margin-bottom: 1.5rem;
        background: #fff;
        border-radius: 0.75rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }
      .btn-pos {
        background-color: #f0fdf4;
        color: #15803d;
        border: 1px solid #bbf7d0;
        padding: 2px 8px;
        border-radius: 99px;
        font-size: 11px;
        margin-right: 4px;
        margin-top: 4px;
        transition: 0.2s;
        cursor: pointer;
      }
      .btn-neg {
        background-color: #fef2f2;
        color: #b91c1c;
        border: 1px solid #fecaca;
        padding: 2px 8px;
        border-radius: 99px;
        font-size: 11px;
        margin-right: 4px;
        margin-top: 4px;
        transition: 0.2s;
        cursor: pointer;
      }
      .btn-pos:hover {
        background-color: #dcfce7;
        transform: translateY(-1px);
      }
      .btn-neg:hover {
        background-color: #fee2e2;
        transform: translateY(-1px);
      }
      .checkmark {
        color: #10b981;
        font-weight: bold;
        margin-left: auto;
        font-size: 14px;
      }
      .loading-overlay {
        position: fixed;
        inset: 0;
        background: rgba(255, 255, 255, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
      }
      .instruction-box {
        background: #eff6ff;
        border: 1px solid #bfdbfe;
        color: #1e40af;
        padding: 10px;
        border-radius: 12px;
        font-size: 12px;
        margin-bottom: 20px;
      }
    </style>
  </head>
  <body class="bg-slate-50 min-h-screen font-sans text-slate-900">
    <div id="loading" class="loading-overlay hidden flex-col">
      <div
        class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-900 mb-4"
      ></div>
      <p class="font-bold text-blue-900">åŒæ­¥é›²ç«¯è³‡æ–™ä¸­...</p>
    </div>

    <nav class="bg-blue-900 text-white shadow-xl p-4 sticky top-0 z-50">
      <div class="container mx-auto flex justify-between items-center">
        <div>
          <h1 class="text-xl font-bold">2026 æ·¡æ±ŸåŒ–æç ”è¨æœƒ</h1>
          <p class="text-xs opacity-70">2026/01/13 | è‡ªå‹•å½™æ•´è©•åˆ†åŠ©ç†</p>
        </div>
        <div class="flex gap-2">
          <button
            onclick="showSection('publicResults')"
            class="text-xs bg-green-600 px-4 py-2 rounded-full"
          >
            å³æ™‚æ’è¡Œæ¦œ
          </button>
          <button
            onclick="showSection('studentQuery')"
            class="text-xs bg-orange-600 px-4 py-2 rounded-full"
          >
            å­¸ç”ŸæŸ¥åˆ†
          </button>
          <button
            onclick="showSection('loginSection')"
            class="text-xs bg-blue-700 px-4 py-2 rounded-full"
          >
            è©•å¯©å…¥å£
          </button>
          <button
            onclick="enterAdmin()"
            class="text-xs bg-red-700 px-4 py-2 rounded-full"
          >
            ç®¡ç†å¾Œå°
          </button>
        </div>
      </div>
    </nav>

    <main class="container mx-auto p-4 max-w-6xl">
      <section id="publicResults" class="hidden space-y-6">
        <h2 class="text-3xl font-black text-center text-blue-900 my-8 italic">
          å„å ´åœ°å³æ™‚æˆç¸¾çœ‹æ¿ (è‡ªå‹•æ›´æ–°)
        </h2>
        <div
          id="publicRankContainer"
          class="grid grid-cols-1 md:grid-cols-2 gap-8"
        ></div>
      </section>

      <section
        id="studentQuery"
        class="hidden max-w-md mx-auto bg-white p-10 mt-12 rounded-3xl shadow-2xl border"
      >
        <h2 class="text-2xl font-black mb-6 text-center text-slate-800">
          æˆç¸¾èˆ‡è©•èªæŸ¥è©¢
        </h2>
        <div class="space-y-4">
          <input
            type="text"
            id="querySid"
            class="w-full p-3 border-2 rounded-xl outline-none focus:border-orange-500"
            placeholder="è«‹è¼¸å…¥å­¸è™Ÿ (å¦‚: 410...)"
          />
          <button
            onclick="fetchStudentResult()"
            class="w-full bg-orange-600 text-white py-4 rounded-xl font-bold shadow-lg"
          >
            æœå°‹æˆ‘çš„ç´€éŒ„
          </button>
        </div>

        <div id="queryResult" class="mt-8 hidden space-y-4">
          <div class="p-4 bg-orange-50 rounded-2xl border border-orange-100">
            <p class="text-xs text-orange-800 font-bold">ç¸½å¹³å‡åˆ†æ•¸</p>
            <p id="resAvg" class="text-5xl font-black text-orange-600">--</p>
          </div>
          <div id="resDetails" class="space-y-3"></div>
        </div>
      </section>

      <section
        id="loginSection"
        class="hidden max-w-md mx-auto bg-white p-10 mt-12 rounded-3xl shadow-2xl border"
      >
        <h2 class="text-2xl font-black mb-8 text-center text-slate-800">
          è©•å¯©ç™»å…¥
        </h2>
        <div class="space-y-6">
          <select
            id="jVenue"
            class="w-full p-3 border-2 rounded-xl bg-slate-50 outline-none focus:border-blue-500"
          ></select>
          <input
            type="text"
            id="jName"
            class="w-full p-3 border-2 rounded-xl outline-none focus:border-blue-500"
            placeholder="è«‹è¼¸å…¥è©•å¯©å§“å"
          />
          <input
            type="password"
            id="jPassword"
            class="w-full p-4 border-2 rounded-2xl outline-none focus:border-blue-600 text-center text-2xl tracking-widest"
            placeholder="è«‹è¼¸å…¥äººå“¡ä»£è™Ÿ"
          />
          <button
            onclick="judgeLogin()"
            class="w-full bg-blue-600 text-white py-4 rounded-xl font-bold shadow-lg hover:bg-blue-700 transition"
          >
            é€²å…¥è©•åˆ†æ¸…å–®ç³»çµ±
          </button>
          <br />è©•åˆ†æˆªæ­¢æ™‚é–“ï¼ˆ2026å¹´1æœˆ13æ—¥ ä¸‹åˆ 4:00ï¼‰
        </div>
      </section>

      <section id="judgeDashboard" class="hidden space-y-6">
        <div class="flex justify-between items-center border-b pb-4">
          <h2 id="displayVenue" class="text-2xl font-black text-blue-900">
            å ´åœ°åå–®
          </h2>
          <div class="text-right">
            <p id="displayRoom" class="text-slate-500 font-bold text-sm">
              æ•™å®¤ï¼š--
            </p>
            <p id="displayJudge" class="text-xs text-slate-400 font-bold">
              è©•å¯©ï¼š--
            </p>
          </div>
        </div>
        <div
          id="studentListContainer"
          class="bg-white rounded-2xl shadow-md border overflow-hidden"
        ></div>
      </section>

      <section
        id="scoreSection"
        class="hidden max-w-4xl mx-auto bg-white p-8 rounded-3xl shadow-2xl border-t-8 border-blue-900"
      >
        <button
          onclick="showSection('judgeDashboard')"
          class="mb-6 text-blue-600 font-bold hover:underline"
        >
          â† è¿”å›åå–®
        </button>
        <div class="instruction-box">
          <strong>ğŸ’¡ æ“ä½œèªªæ˜ï¼š</strong><br />
          é»é¸ä¸‹æ–¹ç¶­åº¦ä¸­çš„
          <span class="text-green-700 font-bold">ç¶ è‰²æŒ‰éˆ•</span> (æ­£é¢è©•åƒ¹) æˆ–
          <span class="text-red-700 font-bold">ç´…è‰²æŒ‰éˆ•</span>
          (å¾…åŠ å¼·å»ºè­°)ï¼Œè©•èªæœƒè‡ªå‹•å½™æ•´è‡³ä¸‹æ–¹çš„ã€Œå§”å“¡ç¸½çµå»ºè­°ã€ã€‚æ‚¨ä¹Ÿå¯ä»¥åœ¨æ ¼å­å…§è‡ªè¡Œè¼¸å…¥æ–‡å­—ï¼Œç³»çµ±æœƒå³æ™‚åŒæ­¥ã€‚
        </div>

        <div class="mb-8 border-b pb-4 flex justify-between items-end">
          <div>
            <h2 id="scoringName" class="text-3xl font-black text-slate-800">
              å§“å
            </h2>
            <p id="scoringTitle" class="text-slate-500 text-sm mt-1 italic">
              é¡Œç›®
            </p>
          </div>
          <p id="scoringAdvisor" class="text-blue-700 text-xs font-bold"></p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
          <div class="space-y-4">
            <h3 class="font-bold text-blue-700 border-b pb-2">
              A. å°ˆæ¥­è©•èª (70%)
            </h3>
            <div class="dimension-card">
              <label class="block text-xs font-bold text-slate-500 mb-1"
                >å ±å‘Šå…§å®¹å»ºè­°</label
              >
              <input
                type="text"
                id="r_content"
                oninput="syncToOverall()"
                class="w-full text-xs border-b outline-none p-1"
                placeholder="è¼¸å…¥æˆ–é»é¸ä¸‹æ–¹æŒ‰éˆ•..."
              />
              <div class="flex flex-wrap mt-2">
                <button
                  onclick="appendReason('r_content','æ¶æ§‹å®Œæ•´ï¼Œè«–è¿°å±¤æ¬¡åˆ†æ˜ï¼Œå±•ç¾é«˜åº¦å°ˆæ¥­ã€‚')"
                  class="btn-pos"
                >
                  æ¶æ§‹å®Œæ•´ï¼Œè«–è¿°å±¤æ¬¡åˆ†æ˜ï¼Œå±•ç¾é«˜åº¦å°ˆæ¥­ã€‚
                </button>
                <button
                  onclick="appendReason('r_content','é‚è¼¯æ¨è«–åš´è¬¹ï¼Œç ”ç©¶æ•¸æ“šå…·å‚™èªªæœåŠ›ã€‚')"
                  class="btn-pos"
                >
                  é‚è¼¯æ¨è«–åš´è¬¹ï¼Œç ”ç©¶æ•¸æ“šå…·å‚™èªªæœåŠ›ã€‚
                </button>
                <button
                  onclick="appendReason('r_content','ç ”ç©¶ç›®æ¨™æ˜ç¢ºï¼Œæ ¸å¿ƒåƒ¹å€¼æ•˜è¿°è©³ç›¡ã€‚')"
                  class="btn-pos"
                >
                  ç ”ç©¶ç›®æ¨™æ˜ç¢ºï¼Œæ ¸å¿ƒåƒ¹å€¼æ•˜è¿°è©³ç›¡ã€‚
                </button>
                <button
                  onclick="appendReason('r_content','æ–‡ç»å¼•è¿°ç²¾ç¢ºï¼Œèƒ½æœ‰æ•ˆæ”¯æ’å€‹äººè«–é»ã€‚')"
                  class="btn-pos"
                >
                  æ–‡ç»å¼•è¿°ç²¾ç¢ºï¼Œèƒ½æœ‰æ•ˆæ”¯æ’å€‹äººè«–é»ã€‚
                </button>

                <button
                  onclick="appendReason('r_content','å…§å®¹é‡å¿ƒä¸å¤ èšç„¦ï¼Œå»ºè­°é‡æ–°æ¢³ç†ç ”ç©¶å‹•æ©Ÿã€‚')"
                  class="btn-neg"
                >
                  å…§å®¹é‡å¿ƒä¸å¤ èšç„¦ï¼Œå»ºè­°é‡æ–°æ¢³ç†ç ”ç©¶å‹•æ©Ÿã€‚
                </button>
                <button
                  onclick="appendReason('r_content','æŠ•å½±ç‰‡æ–‡å­—éæ–¼å†—é•·ï¼Œæ‡‰å¤šåˆ©ç”¨åœ–è¡¨å‘ˆç¾é—œéµæ•¸æ“šã€‚')"
                  class="btn-neg"
                >
                  æŠ•å½±ç‰‡æ–‡å­—éæ–¼å†—é•·ï¼Œæ‡‰å¤šåˆ©ç”¨åœ–è¡¨å‘ˆç¾é—œéµæ•¸æ“šã€‚
                </button>
                <button
                  onclick="appendReason('r_content','éƒ¨åˆ†ç§‘å­¸æ–¹æ³•è«–è¿°ä¸è¶³ï¼Œå»ºè­°åŠ å¼·å¯¦é©—ç´°ç¯€ä¹‹èªªæ˜ã€‚')"
                  class="btn-neg"
                >
                  éƒ¨åˆ†ç§‘å­¸æ–¹æ³•è«–è¿°ä¸è¶³ï¼Œå»ºè­°åŠ å¼·å¯¦é©—ç´°ç¯€ä¹‹èªªæ˜ã€‚
                </button>
                <button
                  onclick="appendReason('r_content','çµè«–èˆ‡æ•¸æ“šé—œè¯æ€§ç¨å¼±ï¼Œå»ºè­°å¼·åŒ–è«–è­‰éç¨‹ã€‚')"
                  class="btn-neg"
                >
                  çµè«–èˆ‡æ•¸æ“šé—œè¯æ€§ç¨å¼±ï¼Œå»ºè­°å¼·åŒ–è«–è­‰éç¨‹ã€‚
                </button>
              </div>
            </div>
            <div class="dimension-card">
              <label class="block text-xs font-bold text-slate-500 mb-1"
                >è¡¨é”æµæš¢åº¦å»ºè­°</label
              >
              <input
                type="text"
                id="r_fluency"
                oninput="syncToOverall()"
                class="w-full text-xs border-b outline-none p-1"
              />
              <div class="flex flex-wrap mt-2">
                <button
                  onclick="appendReason('r_fluency','å£é½’æ¸…æ™°ã€æ•˜äº‹è‡ªç„¶æµæš¢ï¼Œæ¥µå…·æ„ŸæŸ“åŠ›ã€‚')"
                  class="btn-pos"
                >
                  å£é½’æ¸…æ™°ã€æ•˜äº‹è‡ªç„¶æµæš¢ï¼Œæ¥µå…·æ„ŸæŸ“åŠ›ã€‚
                </button>
                <button
                  onclick="appendReason('r_fluency','è¡¨ç¾è‡ªä¿¡æ²‰ç©©ï¼Œèƒ½å¸¶é ˜è½çœ¾æŒæ¡æ¼”è¬›ç¯€å¥ã€‚')"
                  class="btn-pos"
                >
                  è¡¨ç¾è‡ªä¿¡æ²‰ç©©ï¼Œèƒ½å¸¶é ˜è½çœ¾æŒæ¡æ¼”è¬›ç¯€å¥ã€‚
                </button>
                <button
                  onclick="appendReason('r_fluency','å°å…§å®¹æ¥µåº¦ç†Ÿç¨”ï¼Œå±•ç¾å„ªç•°çš„å°ˆæ¥­ç´ é¤Šã€‚')"
                  class="btn-pos"
                >
                  å°å…§å®¹æ¥µåº¦ç†Ÿç¨”ï¼Œå±•ç¾å„ªç•°çš„å°ˆæ¥­ç´ é¤Šã€‚
                </button>
                <button
                  onclick="appendReason('r_fluency','å”¸ç¨¿æ„Ÿè¼ƒé‡ï¼Œå»ºè­°å¢åŠ èˆ‡è§€çœ¾çš„çœ¼ç¥äº’å‹•ã€‚')"
                  class="btn-neg"
                >
                  å”¸ç¨¿æ„Ÿè¼ƒé‡ï¼Œå»ºè­°å¢åŠ èˆ‡è§€çœ¾çš„çœ¼ç¥äº’å‹•ã€‚
                </button>
                <button
                  onclick="appendReason('r_fluency','èªªè©±èªé€Ÿåå¿«ï¼Œå»ºè­°é©æ™‚åœé “ä»¥åˆ©è½çœ¾å¸æ”¶ã€‚')"
                  class="btn-neg"
                >
                  èªªè©±èªé€Ÿåå¿«ï¼Œå»ºè­°é©æ™‚åœé “ä»¥åˆ©è½çœ¾å¸æ”¶ã€‚
                </button>
                <button
                  onclick="appendReason('r_fluency','è¡¨é”ç¨é¡¯ç”Ÿç¡¬ï¼Œå»ºè­°åŠ å¼·å„ç« ç¯€é–“çš„èªæ„éŠœæ¥ã€‚')"
                  class="btn-neg"
                >
                  è¡¨é”ç¨é¡¯ç”Ÿç¡¬ï¼Œå»ºè­°åŠ å¼·å„ç« ç¯€é–“çš„èªæ„éŠœæ¥ã€‚
                </button>
              </div>
            </div>
            <div class="dimension-card">
              <label class="block text-xs font-bold text-slate-500 mb-1"
                >æå•è©®é‡‹å»ºè­°</label
              >
              <input
                type="text"
                id="r_qa"
                oninput="syncToOverall()"
                class="w-full text-xs border-b outline-none p-1"
              />
              <div class="flex flex-wrap mt-2">
                <button
                  onclick="appendReason('r_qa','ç­”è©¢åˆ‡ä¸­è¦é ˜ï¼Œå°ç ”ç©¶ç´°ç¯€æŒæ¡åº¦æ¥µé«˜ã€‚')"
                  class="btn-pos"
                >
                  ç­”è©¢åˆ‡ä¸­è¦é ˜ï¼Œå°ç ”ç©¶ç´°ç¯€æŒæ¡åº¦æ¥µé«˜ã€‚
                </button>
                <button
                  onclick="appendReason('r_qa','é‚è¼¯æ‡‰è®ŠåŠ›å¼·ï¼Œèƒ½é‡å°è³ªç–‘çµ¦äºˆç§‘å­¸æ€§å›è¦†ã€‚')"
                  class="btn-pos"
                >
                  é‚è¼¯æ‡‰è®ŠåŠ›å¼·ï¼Œèƒ½é‡å°è³ªç–‘çµ¦äºˆç§‘å­¸æ€§å›è¦†ã€‚
                </button>
                <button
                  onclick="appendReason('r_qa','æ…‹åº¦è¬™å’Œå¾—é«”ï¼Œèƒ½æ­£é¢ç©æ¥µèˆ‡å§”å“¡è¨è«–ã€‚')"
                  class="btn-pos"
                >
                  æ…‹åº¦è¬™å’Œå¾—é«”ï¼Œèƒ½æ­£é¢ç©æ¥µèˆ‡å§”å“¡è¨è«–ã€‚
                </button>
                <button
                  onclick="appendReason('r_qa','å›è¦†éæ–¼ç°¡ç•¥ï¼Œå»ºè­°å°å•é¡Œæ ¸å¿ƒé€²è¡Œæ·±åº¦è«–è¿°ã€‚')"
                  class="btn-neg"
                >
                  å›è¦†éæ–¼ç°¡ç•¥ï¼Œå»ºè­°å°å•é¡Œæ ¸å¿ƒé€²è¡Œæ·±åº¦è«–è¿°ã€‚
                </button>
                <button
                  onclick="appendReason('r_qa','ç­”è©¢å…§å®¹èˆ‡ç ”ç©¶æ–¹æ³•æœªç›¡ä¸€è‡´ï¼Œæ‡‰é‡æ–°é‡æ¸…è§€å¿µã€‚')"
                  class="btn-neg"
                >
                  ç­”è©¢å…§å®¹èˆ‡ç ”ç©¶æ–¹æ³•æœªç›¡ä¸€è‡´ï¼Œæ‡‰é‡æ–°é‡æ¸…è§€å¿µã€‚
                </button>
                <button
                  onclick="appendReason('r_qa','é¢å°æå•åæ‡‰è¼ƒæ…¢ï¼Œå»ºè­°åŠ å¼·æ¨¡æ“¬è¨“ç·´ä»¥æå‡æ‡‰è®Šã€‚')"
                  class="btn-neg"
                >
                  é¢å°æå•åæ‡‰è¼ƒæ…¢ï¼Œå»ºè­°åŠ å¼·æ¨¡æ“¬è¨“ç·´ä»¥æå‡æ‡‰è®Šã€‚
                </button>
              </div>
            </div>
            <div class="bg-blue-50 p-4 rounded-xl border">
              <label class="block text-xs font-bold text-blue-800 mb-1"
                >å°ˆæ¥­åŸå§‹åˆ† (0-100)</label
              >
              <input
                type="number"
                id="profRaw"
                class="w-full p-2 text-2xl font-black rounded-lg border-2 outline-none"
                oninput="calcTotal()"
              />
            </div>
          </div>

          <div class="space-y-4">
            <h3 class="font-bold text-green-700 border-b pb-2">
              B. æŠ€è¡“è©•èª (30%)
            </h3>
            <div class="dimension-card" style="border-left-color: #22c55e">
              <label class="block text-xs font-bold text-slate-500 mb-1"
                >æ™‚é–“æŒæ§å»ºè­°</label
              >
              <input
                type="text"
                id="r_time"
                oninput="syncToOverall()"
                class="w-full text-xs border-b outline-none p-1"
              />
              <div class="flex flex-wrap mt-2">
                <button
                  onclick="appendReason('r_time','ç™¼è¡¨ç¯€å¥æŒæ¡å®Œç¾ï¼Œç²¾ç¢ºå®Œæˆå ±å‘Šã€‚')"
                  class="btn-pos"
                >
                  ç™¼è¡¨ç¯€å¥æŒæ¡å®Œç¾ï¼Œç²¾ç¢ºå®Œæˆå ±å‘Šã€‚
                </button>
                <button
                  onclick="appendReason('r_time','å…§å®¹åˆ†é…å‡è¡¡ï¼Œåœ¨æ™‚é™å…§å®Œæ•´å‘ˆç¾ç ”ç©¶ç²¾è¯ã€‚')"
                  class="btn-pos"
                >
                  å…§å®¹åˆ†é…å‡è¡¡ï¼Œåœ¨æ™‚é™å…§å®Œæ•´å‘ˆç¾ç ”ç©¶ç²¾è¯ã€‚
                </button>
                <button
                  onclick="appendReason('r_time','ç™¼è¡¨è¶…æ™‚ï¼Œå»ºè­°é‡æ–°ç²¾ç°¡ç°¡å ±é æ•¸èˆ‡è«–è¿°é‡é»ã€‚')"
                  class="btn-neg"
                >
                  ç™¼è¡¨è¶…æ™‚ï¼Œå»ºè­°é‡æ–°ç²¾ç°¡ç°¡å ±é æ•¸èˆ‡è«–è¿°é‡é»ã€‚
                </button>
                <button
                  onclick="appendReason('r_time','å‰è¨€ä½”æ¯”éé«˜ï¼Œå°è‡´å¾Œæ®µæ ¸å¿ƒæˆæœæè¿°å¤ªåŒ†ä¿ƒã€‚')"
                  class="btn-neg"
                >
                  å‰è¨€ä½”æ¯”éé«˜ï¼Œå°è‡´å¾Œæ®µæ ¸å¿ƒæˆæœæè¿°å¤ªåŒ†ä¿ƒã€‚
                </button>
                <button
                  onclick="appendReason('r_time','å‰©é¤˜æ™‚é–“éå¤šï¼Œå»ºè­°å¢åŠ å°ç ”ç©¶æˆæœçš„æ·±åº¦è§£èªªã€‚')"
                  class="btn-neg"
                >
                  å‰©é¤˜æ™‚é–“éå¤šï¼Œå»ºè­°å¢åŠ å°ç ”ç©¶æˆæœçš„æ·±åº¦è§£èªªã€‚
                </button>
              </div>
            </div>
            <div class="dimension-card" style="border-left-color: #22c55e">
              <label class="block text-xs font-bold text-slate-500 mb-1"
                >æœå„€å„€æ…‹å»ºè­°</label
              >
              <input
                type="text"
                id="r_outfit"
                oninput="syncToOverall()"
                class="w-full text-xs border-b outline-none p-1"
              />
              <div class="flex flex-wrap mt-2">
                <button
                  onclick="appendReason('r_outfit','æœå„€èŠé‡å¾—é«”ï¼Œå±•ç¾å„ªè‰¯çš„å°ˆæ¥­å½¢è±¡ã€‚')"
                  class="btn-pos"
                >
                  æœå„€èŠé‡å¾—é«”ï¼Œå±•ç¾å„ªè‰¯çš„å°ˆæ¥­å½¢è±¡ã€‚
                </button>
                <button
                  onclick="appendReason('r_outfit','èˆ‰æ­¢ç«¯èŠå¤§æ–¹ï¼Œç¬¦åˆå­¸è¡“å ´åˆç¦®å„€ã€‚')"
                  class="btn-pos"
                >
                  èˆ‰æ­¢ç«¯èŠå¤§æ–¹ï¼Œç¬¦åˆå­¸è¡“å ´åˆç¦®å„€ã€‚
                </button>
                <button
                  onclick="appendReason('r_outfit','æœè£å»ºè­°å¯ä»¥æ›´ç‚ºæ­£å¼ï¼Œä»¥å¢é€²æ•´é«”å°ˆæ¥­æ„Ÿã€‚')"
                  class="btn-neg"
                >
                  æœè£å»ºè­°å¯ä»¥æ›´ç‚ºæ­£å¼ï¼Œä»¥å¢é€²æ•´é«”å°ˆæ¥­æ„Ÿã€‚
                </button>
                <button
                  onclick="appendReason('r_outfit','è¡¨æƒ…èˆ‡è‚¢é«”å„€æ…‹ç•¥é¡¯ç·Šå¼µï¼Œå¯é€éå¤šåŠ ç·´ç¿’æå‡è‡ªç„¶åº¦ã€‚')"
                  class="btn-neg"
                >
                  è¡¨æƒ…èˆ‡è‚¢é«”å„€æ…‹ç•¥é¡¯ç·Šå¼µï¼Œå¯é€éå¤šåŠ ç·´ç¿’æå‡è‡ªç„¶åº¦ã€‚
                </button>
              </div>
            </div>
            <div class="bg-green-50 p-4 rounded-xl border">
              <label class="block text-xs font-bold text-green-800 mb-1"
                >æŠ€è¡“åŸå§‹åˆ† (0-100)</label
              >
              <input
                type="number"
                id="techRaw"
                class="w-full p-2 text-2xl font-black rounded-lg border-2 outline-none"
                oninput="calcTotal()"
              />
            </div>
            <div class="p-4 bg-slate-100 rounded-xl border mt-4">
              <label class="block text-sm font-bold text-blue-900 mb-2"
                >â— å§”å“¡ç¸½çµå»ºè­°ï¼š</label
              >
              <textarea
                id="judgeComment"
                class="w-full p-3 text-sm border-2 rounded-xl h-40 outline-none"
                placeholder="å½™æ•´ä¸­..."
              ></textarea>
            </div>
          </div>
        </div>

        <div
          class="mt-8 flex flex-col md:flex-row justify-between items-center bg-slate-900 text-white p-8 rounded-3xl gap-4"
        >
          <div>
            åŠ æ¬Šæˆç¸¾ï¼š<span
              id="finalScoreDisplay"
              class="text-6xl font-black text-yellow-400"
              >0</span
            >åˆ†
          </div>
          <div class="flex gap-2">
            <button
              onclick="deleteGradingFromCloud()"
              class="bg-red-600 px-6 py-4 rounded-2xl font-bold"
            >
              åˆªé™¤ç´€éŒ„
            </button>
            <button
              onclick="submitGradingToCloud()"
              class="bg-blue-600 px-12 py-4 rounded-2xl font-black text-xl shadow-xl"
            >
              é€å‡ºè©•åˆ†
            </button>
          </div>
        </div>
      </section>

      <section
        id="adminDashboard"
        class="hidden bg-white rounded-3xl shadow-xl p-8"
      >
        <div class="flex gap-6 border-b-2 mb-8">
          <button
            onclick="toggleAdminTab('venue')"
            id="tab-btn-venue"
            class="admin-tab active pb-4 px-2"
          >
            å ´åœ°èˆ‡å¯†ç¢¼
          </button>
          <button
            onclick="toggleAdminTab('student')"
            id="tab-btn-student"
            class="admin-tab pb-4 px-2"
          >
            åå–®åŒ¯å…¥
          </button>
        </div>
        <div id="admin-venue" class="admin-content space-y-6">
          <div
            id="venueConfigContainer"
            class="grid grid-cols-1 md:grid-cols-2 gap-6"
          ></div>
          <div class="flex gap-4">
            <button
              onclick="saveAdminConfig()"
              class="flex-1 bg-blue-900 text-white py-3 rounded-xl font-bold"
            >
              å„²å­˜é…ç½®
            </button>
            <button
              onclick="exportAllScores()"
              class="flex-1 bg-green-600 text-white py-3 rounded-xl font-bold"
            >
              ğŸ“Š åŒ¯ç”Ÿæˆç¸¾ Excel
            </button>
          </div>
        </div>
        <div id="admin-student" class="admin-content hidden space-y-6">
          <div
            class="p-6 border-2 border-dashed rounded-2xl bg-slate-50 flex justify-between items-center"
          >
            <input
              type="file"
              onchange="handleExcelImport(this)"
              class="text-sm"
            />
            <button
              onclick="clearStudentsCloud()"
              class="bg-red-50 text-red-600 px-6 py-2 rounded-xl"
            >
              æ¸…ç©ºåå–®
            </button>
          </div>
          <div class="overflow-x-auto">
            <table
              id="adminStudentTable"
              class="w-full border-collapse block md:table"
            ></table>
          </div>
        </div>
      </section>
    </main>

    <script>
      // Firebase é…ç½®
      const firebaseConfig = {
        apiKey: "AIzaSyBNa3SAk7yqzRjPyYuKZyLIJesm6M7c57w",
        authDomain: "cme-seminar2026.firebaseapp.com",
        projectId: "cme-seminar2026",
        storageBucket: "cme-seminar2026.firebasestorage.app",
        messagingSenderId: "61658181836",
        appId: "1:61658181836:web:6c8d964c66512575dc9269",
      };
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      let students = [],
        scores = [],
        currentUser = null,
        activeStudent = null;
      let venueConfig = {
        A1: { room: "", judges: ["", ""], passwords: ["", ""] },
        A2: { room: "", judges: ["", ""], passwords: ["", ""] },
        B1: { room: "", judges: ["", ""], passwords: ["", ""] },
        B2: { room: "", judges: ["", ""], passwords: ["", ""] },
      };
      const venues = ["A1", "A2", "B1", "B2"];

      window.onload = async () => {
        toggleLoading(true);
        try {
          const configDoc = await db
            .collection("Settings")
            .doc("VenueConfig")
            .get();
          if (configDoc.exists) {
            venueConfig = configDoc.data();
          }
          renderAdminConfigUI();
          renderVenueSelect(); // <--- åŠ å…¥é€™è¡Œ

          // ... åŸæœ¬çš„ snapshot ç›£è½ç¨‹å¼ç¢¼ ...

          db.collection("Students").onSnapshot((snap) => {
            students = snap.docs.map((doc) => doc.data());
            renderAdminList();
            if (currentUser) renderStudentList();
          });
          db.collection("Scores").onSnapshot((snap) => {
            scores = snap.docs.map((doc) => doc.data());
            renderPublicResults();
            if (currentUser) renderStudentList();
          });
        } catch (e) {
          console.error(e);
        } finally {
          toggleLoading(false);
          showSection("publicResults");
        }
      };

      function renderAdminConfigUI() {
        document.getElementById("venueConfigContainer").innerHTML = venues
          .map(
            (v) => `
          <div class="p-5 border rounded-2xl bg-slate-50">
            <div class="flex gap-2 mb-4"><span class="bg-blue-900 text-white px-3 py-1 rounded font-bold">${v}</span>
            <input type="text" id="vRoom_${v}" value="${
              venueConfig[v].room || ""
            }" placeholder="æ•™å®¤" class="flex-1 border-b bg-transparent outline-none"></div>
            <div class="grid grid-cols-2 gap-2">
              <input type="text" id="vJudge_${v}_1" value="${
              venueConfig[v].judges[0] || ""
            }" placeholder="è©•å¯©1å§“å" class="p-2 border rounded text-xs">
              <input type="text" id="vPwd_${v}_1" value="${
              venueConfig[v].passwords ? venueConfig[v].passwords[0] : ""
            }" placeholder="å¯†ç¢¼1" class="p-2 border rounded text-xs">
              <input type="text" id="vJudge_${v}_2" value="${
              venueConfig[v].judges[1] || ""
            }" placeholder="è©•å¯©2å§“å" class="p-2 border rounded text-xs">
              <input type="text" id="vPwd_${v}_2" value="${
              venueConfig[v].passwords ? venueConfig[v].passwords[1] : ""
            }" placeholder="å¯†ç¢¼2" class="p-2 border rounded text-xs">
            </div>
          </div>`
          )
          .join("");
      }

      //è©•å¯©ç™»å…¥
      function judgeLogin() {
        const v = document.getElementById("jVenue").value;
        const n = document.getElementById("jName").value.trim();
        if (!n || !venueConfig[v].judges.includes(n))
          return alert("å§“åä¸åœ¨è©²å ´åœ°è©•å¯©åå–®ä¸­");
        const p = document.getElementById("jPassword").value.trim();
        if (!p) return alert("è«‹è¼¸å…¥å¯†ç¢¼");
        let found = null;
        for (let v of venues) {
          const cfg = venueConfig[v];
          if (cfg && cfg.passwords) {
            const idx = cfg.passwords.indexOf(p);
            if (idx !== -1) {
              found = { name: cfg.judges[idx], venue: v, room: cfg.room };
              break;
            }
          }
        }
        if (found) {
          currentUser = found;
          document.getElementById(
            "displayVenue"
          ).innerText = `${found.venue} å ´åœ°æ¸…å–®`;
          document.getElementById(
            "displayRoom"
          ).innerText = `æ•™å®¤ï¼š${found.room}`;
          document.getElementById(
            "displayJudge"
          ).innerText = `è©•å¯©ï¼š${found.name}`;
          showSection("judgeDashboard");
          renderStudentList();
        } else {
          alert("å¯†ç¢¼éŒ¯èª¤ï¼");
        }
      }

      async function fetchStudentResult() {
        const sid = document.getElementById("querySid").value.trim();
        if (!sid) return alert("è«‹è¼¸å…¥å­¸è™Ÿ");
        toggleLoading(true);
        try {
          const snap = await db
            .collection("Scores")
            .where("studentId", "==", sid)
            .get();
          if (snap.empty) {
            alert("å°šæœªæœ‰è©•åˆ†ç´€éŒ„");
            document.getElementById("queryResult").classList.add("hidden");
          } else {
            let sum = 0,
              html = "";
            snap.forEach((doc) => {
              const d = doc.data();
              sum += d.total;
              html += `<div class="p-4 bg-white border rounded-xl text-sm"><p class="font-bold text-blue-900 border-b mb-2">è©•å¯©å»ºè­°ï¼š</p><p class="italic text-slate-600">${
                d.feedback_json.summary || "ç„¡è©•èª"
              }</p></div>`;
            });
            document.getElementById("resAvg").innerText = Math.round(
              sum / snap.size
            );
            document.getElementById("resDetails").innerHTML = html;
            document.getElementById("queryResult").classList.remove("hidden");
          }
        } finally {
          toggleLoading(false);
        }
      }

      function openScoring(sid) {
        activeStudent = students.find((s) => s.id === sid);
        document.getElementById("scoringName").innerText = activeStudent.name;
        document.getElementById("scoringTitle").innerText =
          activeStudent.title || "";
        document.getElementById("scoringAdvisor").innerText = `æŒ‡å°æ•™æˆï¼š${
          activeStudent.advisor || "--"
        }`;

        const history = scores.find(
          (sc) => sc.studentId === sid && sc.judge === currentUser.name
        );
        // é‡ç½®æ‰€æœ‰æ¬„ä½
        [
          "profRaw",
          "techRaw",
          "judgeComment",
          "r_content",
          "r_fluency",
          "r_qa",
          "r_time",
          "r_outfit",
        ].forEach((id) => (document.getElementById(id).value = ""));
        document.getElementById("finalScoreDisplay").innerText = "0";

        if (history) {
          document.getElementById("profRaw").value = history.profRaw || "";
          document.getElementById("techRaw").value = history.techRaw || "";
          document.getElementById("judgeComment").value =
            history.feedback_json?.summary || "";
          document.getElementById("finalScoreDisplay").innerText =
            history.total || "0";
          if (history.details) {
            ["content", "fluency", "qa", "time", "outfit"].forEach((k) => {
              if (history.details[k])
                document.getElementById(`r_${k}`).value =
                  history.details[k].reason || "";
            });
          }
        }
        showSection("scoreSection");

        // æª¢æŸ¥æ™‚é–“æ˜¯å¦å·²é
        const isExpired = new Date().getTime() > DEADLINE;
        const submitBtn = document.querySelector(
          "button[onclick='submitGradingToCloud()']"
        );
        const deleteBtn = document.querySelector(
          "button[onclick='deleteGradingFromCloud()']"
        );

        if (isExpired) {
          submitBtn.classList.add("hidden");
          deleteBtn.classList.add("hidden");
          // å¯ä»¥é¡å¤–æç¤º
          document.getElementById(
            "finalScoreDisplay"
          ).parentElement.innerHTML += `<p class="text-red-500 text-sm mt-2">è©•åˆ†å·²æˆªæ­¢ï¼Œç›®å‰åƒ…ä¾›æª¢è¦–</p>`;
        } else {
          submitBtn.classList.remove("hidden");
          deleteBtn.classList.remove("hidden");
        }
      }

      async function deleteGradingFromCloud() {
        if (!checkDeadline()) return; // å…ˆæª¢æŸ¥æ™‚é–“

        if (!confirm("ç¢ºå®šåˆªé™¤æ­¤ç”Ÿè©•åˆ†ç´€éŒ„ï¼Ÿ")) return;
        toggleLoading(true);
        try {
          await db
            .collection("Scores")
            .doc(`${currentUser.name}_${activeStudent.id}`)
            .delete();
          alert("å·²åˆªé™¤");
          showSection("judgeDashboard");
        } finally {
          toggleLoading(false);
        }
      }

      async function submitGradingToCloud() {
        if (!checkDeadline()) return; // å…ˆæª¢æŸ¥æ™‚é–“

        const p = document.getElementById("profRaw").value,
          t = document.getElementById("techRaw").value;
        if (p === "" || t === "") return alert("è«‹è¼¸å…¥åˆ†æ•¸");
        toggleLoading(true);
        try {
          await db
            .collection("Scores")
            .doc(`${currentUser.name}_${activeStudent.id}`)
            .set({
              judge: currentUser.name,
              venue: currentUser.venue,
              studentId: activeStudent.id,
              studentName: activeStudent.name,
              total: parseInt(
                document.getElementById("finalScoreDisplay").innerText
              ),
              profRaw: parseInt(p),
              techRaw: parseInt(t),
              details: {
                content: { reason: document.getElementById("r_content").value },
                fluency: { reason: document.getElementById("r_fluency").value },
                qa: { reason: document.getElementById("r_qa").value },
                time: { reason: document.getElementById("r_time").value },
                outfit: { reason: document.getElementById("r_outfit").value },
              },
              feedback_json: {
                summary: document.getElementById("judgeComment").value,
              },
              timestamp: firebase.firestore.FieldValue.serverTimestamp(),
            });
          alert("è©•åˆ†æˆåŠŸ");
          showSection("judgeDashboard");
        } finally {
          toggleLoading(false);
        }
      }

      function syncToOverall() {
        const map = [
          { id: "r_content", l: "å…§å®¹" },
          { id: "r_fluency", l: "æµæš¢" },
          { id: "r_qa", l: "æ‡‰ç­”" },
          { id: "r_time", l: "æ™‚é–“" },
          { id: "r_outfit", l: "æœå„€" },
        ];
        document.getElementById("judgeComment").value = map
          .map((i) => {
            const v = document.getElementById(i.id).value.trim();
            return v ? `ã€${i.l}ã€‘${v}` : "";
          })
          .filter((s) => s)
          .join("\n");
      }

      function calcTotal() {
        const p = parseFloat(document.getElementById("profRaw").value) || 0,
          t = parseFloat(document.getElementById("techRaw").value) || 0;
        document.getElementById("finalScoreDisplay").innerText = Math.round(
          p * 0.7 + t * 0.3
        );
      }

      function appendReason(id, text) {
        const el = document.getElementById(id);
        if (!el.value.includes(text)) el.value += (el.value ? " " : "") + text;
        syncToOverall();
      }

      async function saveAdminConfig() {
        venues.forEach((v) => {
          venueConfig[v] = {
            room: document.getElementById(`vRoom_${v}`).value,
            judges: [
              document.getElementById(`vJudge_${v}_1`).value,
              document.getElementById(`vJudge_${v}_2`).value,
            ],
            passwords: [
              document.getElementById(`vPwd_${v}_1`).value,
              document.getElementById(`vPwd_${v}_2`).value,
            ],
          };
        });
        await db.collection("Settings").doc("VenueConfig").set(venueConfig);
        alert("å„²å­˜æˆåŠŸ");
      }

      // å¤šæ¬„ä½å³æ™‚æ’è¡Œæ¦œé‚è¼¯
      function renderPublicResults() {
        const container = document.getElementById("publicRankContainer");
        container.innerHTML = venues
          .map((v) => {
            const room = venueConfig[v]?.room || "æœªè¨­å®š";
            const judges = venueConfig[v]?.judges || ["è©•å¯©1", "è©•å¯©2"];
            const vScores = scores.filter((s) => s.venue === v);

            const grouped = {};
            vScores.forEach((s) => {
              if (!grouped[s.studentId])
                grouped[s.studentId] = {
                  name: s.studentName,
                  j1: "--",
                  j2: "--",
                  avg: 0,
                  sum: 0,
                  count: 0,
                };
              if (s.judge === judges[0]) grouped[s.studentId].j1 = s.total;
              else if (s.judge === judges[1]) grouped[s.studentId].j2 = s.total;
              grouped[s.studentId].sum += s.total;
              grouped[s.studentId].count++;
              grouped[s.studentId].avg = Math.round(
                grouped[s.studentId].sum / grouped[s.studentId].count
              );
            });
            const rank = Object.values(grouped).sort((a, b) => b.avg - a.avg);

            return `
            <div class="bg-white p-6 rounded-3xl shadow border-t-8 border-blue-900">
              <h3 class="font-black text-xl mb-4 border-b pb-2 flex justify-between">
                <span>${v} å ´åœ° (${room})</span>
                <span class="text-xs text-blue-500 animate-pulse">Live</span>
              </h3>
              <div class="space-y-3">
                <div class="grid grid-cols-5 text-[10px] text-slate-400 font-bold px-2">
                  <div class="col-span-2">å­¸ç”Ÿå§“å</div>
                  <div class="text-center">è©•å¯©1</div>
                  <div class="text-center">è©•å¯©2</div>
                  <div class="text-right">å¹³å‡</div>
                </div>
                ${
                  rank.length
                    ? rank
                        .map(
                          (r, i) => `
                  <div class="grid grid-cols-5 items-center text-sm p-2 ${
                    i === 0 ? "bg-yellow-50 rounded-lg" : ""
                  }">
                    <div class="col-span-2 font-bold text-slate-700">${
                      i + 1
                    }. ${r.name}</div>
                    <div class="text-center font-mono text-xs text-slate-400">${
                      r.j1
                    }</div>
                    <div class="text-center font-mono text-xs text-slate-400">${
                      r.j2
                    }</div>
                    <div class="text-right font-black ${
                      i === 0 ? "text-blue-700" : "text-slate-600"
                    }">${r.avg}</div>
                  </div>`
                        )
                        .join("")
                    : '<p class="text-xs text-slate-300 text-center py-4">â³ ç­‰å¾…è©•åˆ†ä¸­...</p>'
                }
              </div>
            </div>`;
          })
          .join("");
      }

      function renderStudentList() {
        const container = document.getElementById("studentListContainer");
        const filtered = students.filter((s) => s.venue === currentUser.venue);
        container.innerHTML = filtered
          .map((s) => {
            const isDone = scores.some(
              (sc) => sc.studentId === s.id && sc.judge === currentUser.name
            );
            return `<div onclick="openScoring('${
              s.id
            }')" class="flex justify-between p-4 border-b hover:bg-slate-50 cursor-pointer">
            <div><p class="text-[10px] text-slate-400 font-mono">${
              s.id
            }</p><h3 class="font-bold">${s.name}</h3></div>
            ${
              isDone
                ? '<span class="checkmark">âœ” å·²å®Œæˆ</span>'
                : '<span class="text-xs text-slate-300">å°šæœªè©•åˆ†</span>'
            }
          </div>`;
          })
          .join("");
      }

      function renderAdminList() {
        const tableBody = document.getElementById("adminStudentTable");

        // 1. è¡¨é ­ï¼šåœ¨æ‰‹æ©Ÿç«¯éš±è— (hidden)ï¼Œä¸­è¦–çª—ä»¥ä¸Šé¡¯ç¤º (md:table-header-group)
        const header = `
          <thead class="hidden md:table-header-group bg-slate-100 font-bold">
            <tr>
              <td class="p-3 border">å­¸è™Ÿ (ID)</td>
              <td class="p-3 border">å§“å</td>
              <td class="p-3 border">æŒ‡å°æ•™æˆ</td>
              <td class="p-3 border">è«–æ–‡é¡Œç›®</td>
              <td class="p-3 border text-center">å ´åœ°</td>
            </tr>
          </thead>`;

        // 2. è³‡æ–™åˆ—ï¼šæ‰‹æ©Ÿç«¯è½‰ç‚ºå¡ç‰‡ (block + shadow)ï¼Œä¸­è¦–çª—ä»¥ä¸Šæ¢å¾©ç‚ºè¡¨æ ¼åˆ— (md:table-row)
        const rows = students
          .map(
            (s) => `
          <tr class="block md:table-row mb-4 md:mb-0 bg-white border md:border-b shadow-sm md:shadow-none rounded-xl md:rounded-none p-4 md:p-0">
      
            <td data-label="å­¸è™Ÿ" class="block md:table-cell p-1 md:p-3 text-xs font-mono text-slate-500 md:text-slate-900 
              before:content-[attr(data-label)] before:md:hidden before:font-bold before:mr-2 before:text-slate-400">
              ${s.id}
            </td>
      
            <td data-label="å§“å" class="block md:table-cell p-1 md:p-3 font-bold text-lg md:text-base
              before:content-[attr(data-label)] before:md:hidden before:font-bold before:mr-2 before:text-slate-400">
              ${s.name}
            </td>
      
            <td data-label="æŒ‡å°æ•™æˆ" class="block md:table-cell p-1 md:p-3 text-sm
              before:content-[attr(data-label)] before:md:hidden before:font-bold before:mr-2 before:text-slate-400">
              ${s.advisor || "--"}
            </td>
      
            <td data-label="è«–æ–‡é¡Œç›®" class="block md:table-cell p-1 md:p-3 text-xs text-slate-600
              before:content-[attr(data-label)] before:md:hidden before:font-bold before:mr-2 before:text-slate-400">
              ${s.title || "--"}
            </td>
      
            <td data-label="å ´åœ°" class="block md:table-cell p-1 md:p-3 text-left md:text-center
              before:content-[attr(data-label)] before:md:hidden before:font-bold before:mr-2 before:text-slate-400">
              <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-xs font-bold inline-block mt-1 md:mt-0">
                ${s.venue}
              </span>
            </td>
      
          </tr>
        `
          )
          .join("");

        tableBody.innerHTML =
          header + `<tbody class="block md:table-row-group">${rows}</tbody>`;
      }

      async function handleExcelImport(input) {
        const reader = new FileReader();
        reader.onload = async (e) => {
          const data = XLSX.read(new Uint8Array(e.target.result), {
            type: "array",
          });
          const json = XLSX.utils.sheet_to_json(
            data.Sheets[data.SheetNames[0]],
            { header: 1 }
          );
          const batch = db.batch();
          json.slice(1).forEach((r) => {
            if (r[0])
              batch.set(db.collection("Students").doc(String(r[0])), {
                id: String(r[0]),
                name: r[1],
                advisor: r[2],
                title: r[3],
                venue: r[4] ? String(r[4]).toUpperCase().trim() : "æœªåˆ†é…",
              });
          });
          await batch.commit();
          alert("åŒ¯å…¥æˆåŠŸ");
        };
        reader.readAsArrayBuffer(input.files[0]);
      }

      function exportAllScores() {
        const data = scores.map((s) => ({
          å ´åœ°: s.venue,
          è©•å¯©: s.judge,
          å­¸ç”Ÿ: s.studentName,
          å­¸è™Ÿ: s.studentId,
          å°ˆæ¥­åˆ†: s.profRaw,
          æŠ€è¡“åˆ†: s.techRaw,
          åŠ æ¬Šç¸½åˆ†: s.total,
          è©•èª: s.feedback_json.summary,
        }));
        const ws = XLSX.utils.json_to_sheet(data);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Scores");
        XLSX.writeFile(wb, `æˆç¸¾åŒ¯å‡º_${new Date().toLocaleDateString()}.xlsx`);
      }

      function toggleAdminTab(t) {
        document
          .querySelectorAll(".admin-content")
          .forEach((c) => c.classList.add("hidden"));
        document
          .querySelectorAll(".admin-tab")
          .forEach((b) => b.classList.remove("active"));
        document.getElementById(`admin-${t}`).classList.remove("hidden");
        document.getElementById(`tab-btn-${t}`).classList.add("active");
      }
      function showSection(id) {
        document
          .querySelectorAll("main > section")
          .forEach((s) => s.classList.add("hidden"));
        document.getElementById(id).classList.remove("hidden");
        window.scrollTo(0, 0);
      }
      function toggleLoading(s) {
        document.getElementById("loading").classList.toggle("hidden", !s);
      }
      function enterAdmin() {
        if (prompt("è«‹è¼¸å…¥ç®¡ç†å¯†ç¢¼,æç¤ºt~4") === "tedx2614")
          showSection("adminDashboard");
      }
      function clearStudentsCloud() {
        if (confirm("ç¢ºå®šæ¸…ç©ºï¼Ÿ"))
          db.collection("Students")
            .get()
            .then((qs) => {
              const b = db.batch();
              qs.forEach((d) => b.delete(d.ref));
              b.commit();
            });
      }

      function renderVenueSelect() {
        const select = document.getElementById("jVenue");
        if (!select) return;

        // éæ­· A1, A2, B1, B2 ç­‰å ´åœ°
        select.innerHTML = venues
          .map((v) => {
            // å–å¾—è©²å ´åœ°è¨­å®šçš„æ•™å®¤åç¨±ï¼Œè‹¥æ²’å¡«å¯«å‰‡é¡¯ç¤ºå ´åœ°ç·¨è™Ÿ
            const roomName =
              venueConfig[v] && venueConfig[v].room
                ? venueConfig[v].room
                : `æœªè¨­å®šæ•™å®¤`;
            return `<option value="${v}">${roomName} (${v}å ´åœ°)</option>`;
          })
          .join("");
      }

      // å®šç¾©æˆªæ­¢æ™‚é–“ï¼ˆä¾‹å¦‚ï¼š2026å¹´1æœˆ13æ—¥ ä¸‹åˆ 5:00ï¼‰
      const DEADLINE = new Date("2026-01-13T17:00:00").getTime();

      function checkDeadline() {
        const now = new Date().getTime();
        if (now > DEADLINE) {
          alert("ã€ç³»çµ±æç¤ºã€‘è©•åˆ†æœŸé™å·²éï¼Œç„¡æ³•å†æ–°å¢ã€ä¿®æ”¹æˆ–åˆªé™¤è©•åˆ†ç´€éŒ„ã€‚");
          return false;
        }
        return true;
      }
    </script>
  </body>
</html>
